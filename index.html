<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>남경 검수시스템 · Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ✅ Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    body { background:#eef1f5; }

    .card { background:#fff; border:1px solid #e5e7eb; border-radius:14px; box-shadow:0 1px 2px rgba(0,0,0,.04); }
    .card-h { padding: 8px 10px; border-bottom:1px solid #f1f5f9; display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
    .card-b { padding: 8px 10px; }

    .title { font-size:12px; font-weight:900; color:#0f172a; line-height:1.2; }
    .sub   { font-size:11px; font-weight:700; color:#64748b; line-height:1.2; margin-top:2px; }
    .tag   { font-size:11px; font-weight:800; color:#64748b; white-space:nowrap; }

    .tbl{ width:100%; border-collapse:collapse; table-layout:fixed; }
    .tbl th, .tbl td{
      padding:8px 10px; border-top:1px solid #eef2f7;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis; vertical-align:middle;
      font-size:13px; font-weight:600; color:#0f172a; letter-spacing:-0.1px;
    }
    .tbl thead th{ border-top:none; color:#475569; text-align:center; font-weight:700; }
    .tbl td{ text-align:center; font-variant-numeric: tabular-nums; }
    .tbl th:first-child, .tbl td:first-child{ text-align:left; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

    .cut{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .muted{ color:#94a3b8; font-weight:700; text-align:center; padding:14px 10px; }

    .mini .card-h { padding:8px 10px; }
    .mini .card-b { padding:10px; }
    .kv { display:flex; align-items:center; justify-content:space-between; }
    .kv span { font-size:12px; font-weight:800; color:#475569; }
    .kv b { font-size:12px; font-weight:900; color:#0f172a; font-variant-numeric: tabular-nums; }

    /* ✅ 차트 카드 (캡처 느낌 다크 스타일) */
    .chart-card{
      background: linear-gradient(180deg, #1b2440 0%, #121a33 100%);
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;
      box-shadow:0 10px 28px rgba(15,23,42,.22);
      overflow:hidden;
    }
    .chart-h{
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
    }
    .title2{ font-size:12px; font-weight:950; color:rgba(255,255,255,.92); }
    .sub2{ font-size:11px; font-weight:800; color:rgba(255,255,255,.60); margin-top:2px; }
    .tag2{
      font-size:11px; font-weight:950; color:rgba(255,255,255,.78);
      padding:3px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.08);
      white-space:nowrap;
    }
    .chart-b{ height: 360px; padding:10px 12px 12px; }

    /* ✅ fallback sidebar 스타일(필요시 JS가 1회 생성) */
    #sidebarOverlay{
      position:fixed; inset:0; background:rgba(15,23,42,.55);
      z-index:60;
    }
    #sidebar{
      position:fixed; top:0; left:0; height:100vh; width:280px;
      background:#0A1833; color:#fff; z-index:70;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
  </style>
</head>

<body class="min-h-screen">

  <!-- nav.js (공통 네비/사이드바 담당) -->
  <script src="nav.js"></script>

  <!-- index.js -->
  <script type="module" src="./js/index.js"></script>

  <!-- ✅ nav.js가 사이드바를 안 넣는 경우만: JS가 fallback을 1회 생성함(HTML에는 넣지 않음) -->

  <div class="max-w-[1700px] mx-auto pt-16 px-4 md:px-6 pb-8">
    <div class="relative">
      <main class="min-w-0">

        <!-- 상단바 -->
        <div id="boardBar" class="mb-4 rounded-2xl border border-slate-200 bg-white px-4 py-3 shadow-sm">
          <div class="flex items-center justify-between gap-3">
            <div class="flex items-center gap-3 min-w-0">
              <div class="text-[11px] font-extrabold text-slate-500 tracking-widest">남경 검수시스템</div>
              <div class="hidden md:block text-sm font-extrabold text-slate-900 truncate">DASHBOARD</div>
            </div>

            <div class="flex items-center gap-3">
              <button id="btnSidebar"
                class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-[12px] font-extrabold text-slate-800 hover:bg-slate-50">
                MENU
              </button>

              <div class="text-right">
                <div id="boardClock" class="text-lg md:text-xl font-extrabold tabular-nums text-slate-900">--:--:--</div>
                <div class="text-[11px] text-slate-500">
                  마지막 갱신: <span id="dataUpdatedTop" class="font-extrabold text-sky-700">-</span>
                </div>
              </div>

              <button id="btnFullscreen"
                class="hidden md:inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-[12px] font-extrabold text-slate-800 hover:bg-slate-100">
                FULLSCREEN
              </button>
            </div>
          </div>
        </div>

        <!-- =========================
             상단 3열
        ========================== -->
        <section class="grid grid-cols-12 gap-3">

          <!-- LEFT -->
          <div class="col-span-12 xl:col-span-5 space-y-3">
            <div class="card">
              <div class="card-h">
                <div>
                  <div class="title">출고 요약</div>
                  <div class="sub">컨테이너 · LCL · 요약</div>
                </div>
                <div class="tag">당일</div>
              </div>
              <div class="card-b">
                <table class="tbl">
                  <colgroup>
                    <col style="width:19%"><col style="width:21%"><col style="width:15%">
                    <col style="width:12%"><col style="width:18%"><col style="width:15%">
                  </colgroup>
                  <thead>
                    <tr>
                      <th>인보이스</th><th>국가</th><th>컨테이너</th>
                      <th>위치</th><th>상차시간</th><th>작업여부</th>
                    </tr>
                  </thead>
                  <tbody id="ship_today_tbody">
                    <tr><td colspan="6" class="muted">loading</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- MIDDLE -->
          <div class="col-span-12 xl:col-span-4 space-y-3">

            <div class="card">
              <div class="card-h">
                <div>
                  <div class="title">출고 누계</div>
                  <div class="sub">전체 · 컨테이너 & LCL · 누계</div>
                </div>
                <div class="tag">누계</div>
              </div>
              <div class="card-b">
                <table class="tbl">
                  <colgroup>
                    <col style="width:28%"><col style="width:18%"><col style="width:18%"><col style="width:18%"><col style="width:18%">
                  </colgroup>
                  <thead>
                    <tr>
                      <th>구분</th><th>20pt</th><th>40pt</th><th>LCL</th><th>합계</th>
                    </tr>
                  </thead>
                  <tbody id="ship_total_tbody">
                    <tr><td colspan="5" class="muted">loading</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="card">
              <div class="card-h">
                <div>
                  <div class="title">작업장별 작업수량</div>
                  <div class="sub">전체 누계</div>
                </div>
                <div class="tag">전체누계</div>
              </div>
              <div class="card-b">
                <table class="tbl">
                  <colgroup><col style="width:20%"><col style="width:40%"><col style="width:40%"></colgroup>
                  <thead>
                    <tr><th>구분</th><th>작업량</th><th>평균</th></tr>
                  </thead>
                  <tbody id="work_total_tbody">
                    <tr><td class="cut">보수A</td><td>-</td><td>-</td></tr>
                    <tr><td class="cut">보수B</td><td>-</td><td>-</td></tr>
                    <tr><td class="cut">설비</td><td>-</td><td>-</td></tr>
                    <tr><td class="cut font-extrabold">전체</td><td class="font-extrabold">-</td><td class="font-extrabold">-</td></tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="card mini">
              <div class="card-h">
                <div>
                  <div class="title">재고 합계</div>
                  <div class="sub">wms · 수량 합계</div>
                </div>
                <div class="tag">WMS</div>
              </div>
              <div class="card-b space-y-2">
                <div class="kv"><span>총 수량</span><b id="k_inventory">-</b></div>
              </div>
            </div>

          </div>

          <!-- RIGHT -->
          <div class="col-span-12 xl:col-span-3 space-y-3 mini">

            <div class="card">
              <div class="card-h">
                <div><div class="title">보수작업</div><div class="sub">sap_item + bosu</div></div>
                <div class="tag">당월</div>
              </div>
              <div class="card-b space-y-2">
                <div class="kv"><span>작업 예상량</span><b id="rep_cur_plan">-</b></div>
                <div class="kv"><span>작업량(완료)</span><b id="rep_cur_done">-</b></div>
                <div class="kv"><span>잔량</span><b id="rep_cur_remain">-</b></div>
              </div>
            </div>

            <div class="card">
              <div class="card-h">
                <div><div class="title">보수작업</div><div class="sub">sap_item + bosu</div></div>
                <div class="tag">다음달</div>
              </div>
              <div class="card-b space-y-2">
                <div class="kv"><span>작업 예상량</span><b id="rep_next_plan">-</b></div>
                <div class="kv"><span>작업량(완료)</span><b id="rep_next_done">-</b></div>
                <div class="kv"><span>잔량</span><b id="rep_next_remain">-</b></div>
              </div>
            </div>

            <div class="card">
              <div class="card-h">
                <div><div class="title">설비 작업</div><div class="sub">daily</div></div>
                <div class="tag">전월</div>
              </div>
              <div class="card-b space-y-2">
                <div class="kv"><span>설비 작업량</span><b id="fac_cur_qty">-</b></div>
                <div class="kv"><span>설비 평균 작업량</span><b id="fac_cur_avg">-</b></div>
              </div>
            </div>

            <div class="card">
              <div class="card-h">
                <div><div class="title">설비 작업</div><div class="sub">daily</div></div>
                <div class="tag">당월</div>
              </div>
              <div class="card-b space-y-2">
                <div class="kv"><span>설비 작업량</span><b id="fac_next_qty">-</b></div>
                <div class="kv"><span>설비 평균 작업량</span><b id="fac_next_avg">-</b></div>
              </div>
            </div>

          </div>
        </section>

        <!-- =========================
            ✅ 하단 차트 (50% / 50%)
            - 7일 출고정보
            - 월별 출고 누계
        ========================== -->
        <section class="mt-3 grid grid-cols-12 gap-3">

          <div class="col-span-12 xl:col-span-5">
            <div class="chart-card">
              <div class="chart-h">
                <div>
                  <div class="title2">출고정보</div>
                  <div class="sub2">7일 · 40PT / 20PT / LCL</div>
                </div>
                <div class="tag2">7D</div>
              </div>
              <div class="chart-b">
                <canvas id="chart_ship_7days"></canvas>
              </div>
            </div>
          </div>

          <div class="col-span-12 xl:col-span-7">
            <div class="chart-card">
              <div class="chart-h">
                <div>
                  <div class="title2">월별 출고 누계</div>
                  <div class="sub2">1~12월 · 40PT / 20PT / LCL</div>
                </div>
                <div class="tag2">MONTH</div>
              </div>
              <div class="chart-b">
                <canvas id="chart_ship_monthly"></canvas>
              </div>
            </div>
          </div>

        </section>

      </main>
    </div>
  </div>

  <!-- =========================
        JS: 메뉴 + 시계 + 풀스크린 (nav.js 존재해도 “안 꼬이게”)
  ========================== -->
  <script>
    // ✅ nav.js가 사이드바를 만들지 않는 경우만 fallback 1회 생성
    function ensureFallbackSidebarOnce(){
      if (document.getElementById("sidebar") && document.getElementById("sidebarOverlay")) return;

      // overlay
      if (!document.getElementById("sidebarOverlay")) {
        const ov = document.createElement("div");
        ov.id = "sidebarOverlay";
        ov.className = "hidden";
        document.body.appendChild(ov);
      }

      // sidebar
      if (!document.getElementById("sidebar")) {
        const as = document.createElement("aside");
        as.id = "sidebar";
        as.className = "-translate-x-full transition-transform duration-200";
        as.innerHTML = `
          <div class="p-4 border-b border-white/10 font-extrabold">MENU</div>
          <div class="p-3 space-y-2 text-sm">
            <a class="block px-3 py-2 rounded-lg hover:bg-white/10" href="/index.html">Dashboard</a>
            <a class="block px-3 py-2 rounded-lg hover:bg-white/10" href="/index_repair.html">보수 작업</a>
            <a class="block px-3 py-2 rounded-lg hover:bg-white/10" href="/defect.html">결품 조회</a>
          </div>
        `;
        document.body.appendChild(as);
      }
    }

    // ✅ “그때그때 DOM 다시 찾기” (nav.js가 나중에 넣어도 OK)
    function getSidebarEls(){
      return {
        sidebar: document.getElementById("sidebar"),
        overlay: document.getElementById("sidebarOverlay"),
        btn: document.getElementById("btnSidebar")
      };
    }

    function openSidebar(){
      const { sidebar, overlay } = getSidebarEls();
      if (!sidebar || !overlay) return;
      sidebar.classList.remove("-translate-x-full");
      overlay.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    }
    function closeSidebar(){
      const { sidebar, overlay } = getSidebarEls();
      if (!sidebar || !overlay) return;
      sidebar.classList.add("-translate-x-full");
      overlay.classList.add("hidden");
      document.body.style.overflow = "";
    }

    document.addEventListener("DOMContentLoaded", () => {
      // nav.js가 DOM 삽입을 늦게 하는 경우도 있으니 한 번 보강
      ensureFallbackSidebarOnce();

      const { btn, overlay } = getSidebarEls();
      btn && btn.addEventListener("click", () => {
        const { sidebar } = getSidebarEls();
        if (!sidebar) return;
        const isClosed = sidebar.classList.contains("-translate-x-full");
        if (isClosed) openSidebar();
        else closeSidebar();
      });
      overlay && overlay.addEventListener("click", closeSidebar);
      document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeSidebar(); });

      // Clock (KST)
      const clockEl = document.getElementById("boardClock");
      const fmt = new Intl.DateTimeFormat("ko-KR", { timeZone:"Asia/Seoul", hour:"2-digit", minute:"2-digit", second:"2-digit" });
      function tick(){ if(clockEl) clockEl.textContent = fmt.format(new Date()); }
      tick(); setInterval(tick, 1000);

      // Fullscreen
      const fsBtn = document.getElementById("btnFullscreen");
      fsBtn && fsBtn.addEventListener("click", async () => {
        try{
          if(!document.fullscreenElement) await document.documentElement.requestFullscreen();
          else await document.exitFullscreen();
        }catch(e){ console.warn("fullscreen failed:", e); }
      });
    });
  </script>

</body>
</html>

